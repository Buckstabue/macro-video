<?xml version="1.0" encoding="UTF-8"?>
<xwikidoc>
<web>Macros</web>
<name>Video20</name>
<language></language>
<defaultLanguage>en</defaultLanguage>
<translation>0</translation>
<parent>Macros.WebHome</parent>
<creator>XWiki.Admin</creator>
<author>XWiki.ThomasDelafosse</author>
<customClass></customClass>
<contentAuthor>XWiki.XWikiSAS</contentAuthor>
<creationDate>1367829373000</creationDate>
<date>1383731107000</date>
<contentUpdateDate>1377769972000</contentUpdateDate>
<version>6.1</version>
<title>Video Macro</title>
<template></template>
<defaultTemplate></defaultTemplate>
<validationScript></validationScript>
<comment></comment>
<minorEdit>false</minorEdit>
<syntaxId>xwiki/2.0</syntaxId>
<hidden>true</hidden>
<object>
<class>
<name>XWiki.WikiMacroClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<code>
<disabled>0</disabled>
<name>code</name>
<number>9</number>
<prettyName>Macro code</prettyName>
<rows>20</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</code>
<contentDescription>
<disabled>0</disabled>
<name>contentDescription</name>
<number>8</number>
<prettyName>Content description (Not applicable for "No content" type)</prettyName>
<rows>5</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</contentDescription>
<contentType>
<cache>0</cache>
<disabled>0</disabled>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>contentType</name>
<number>7</number>
<prettyName>Macro content type</prettyName>
<relationalStorage>0</relationalStorage>
<separator>|</separator>
<separators>|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>Optional|Mandatory|No content</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</contentType>
<defaultCategory>
<disabled>0</disabled>
<name>defaultCategory</name>
<number>4</number>
<prettyName>Default category</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</defaultCategory>
<description>
<disabled>0</disabled>
<name>description</name>
<number>3</number>
<prettyName>Macro description</prettyName>
<rows>5</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</description>
<id>
<disabled>0</disabled>
<name>id</name>
<number>1</number>
<prettyName>Macro id</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</id>
<name>
<disabled>0</disabled>
<name>name</name>
<number>2</number>
<prettyName>Macro name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
<supportsInlineMode>
<disabled>0</disabled>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>supportsInlineMode</name>
<number>5</number>
<prettyName>Supports inline mode</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</supportsInlineMode>
<visibility>
<cache>0</cache>
<disabled>0</disabled>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>visibility</name>
<number>6</number>
<prettyName>Macro visibility</prettyName>
<relationalStorage>0</relationalStorage>
<separator>|</separator>
<separators>|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>Current User|Current Wiki|Global</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</visibility>
</class>
<name>Macros.Video20</name>
<number>0</number>
<className>XWiki.WikiMacroClass</className>
<guid>801dd898-1b3f-4b5e-a961-269ed55e69d2</guid>
<property>
<code>{{velocity output=false}}

Compute the URL of the embedded video from the original web URL.

#set ($url = '')
#if ($xcontext.macro.params.url.indexOf('dailymotion') != -1)
  ## DailyMotion URLs have the following format:
  ## http://www.dailymotion.com/video/&lt;videoId&gt;_&lt;pretty-name&gt;
  ## which should be transformed into:
  ## http://www.dailymotion.com/swf/&lt;videoId&gt;
  #set ($url = $xcontext.macro.params.url.replaceAll('^.*/video/(.*)_.*$', 'http://www.dailymotion.com/swf/$1'))
#elseif ($xcontext.macro.params.url.indexOf('youtube') != -1)
  ## YouTube URLs have the following format:
  ## http://www.youtube.com/watch?v=&lt;videoId&gt;&amp;otherParams
  ## which should be transformed into:
  ## https://youtube.googleapis.com/v/&lt;videoId&gt;
  #set ($url = $xcontext.macro.params.url.replaceAll('^.*?[&amp;?]v=(.*?)(&amp;.*|$)', 'https://youtube.googleapis.com/v/$1?hd=1'))
#elseif ($xcontext.macro.params.url.indexOf('google') != -1)
  ## Google Video URLs have the following format:
  ## http://video.google.com/videoplay?docid=&lt;videoId&gt;
  ## which should be transformed into:
  ## http://video.google.com/googleplayer.swf?docid=&lt;videoId&gt;
  #set ($url = $xcontext.macro.params.url.replaceAll('^.*?[&amp;?]docid=(.*?)(&amp;.*|$)', 'http://video.google.com/googleplayer.swf?docid=$1'))
#elseif ($xcontext.macro.params.url.indexOf('vimeo') != -1)
  ## Vimeo URLs have the following format:
  ## http://vimeo.com/&lt;videoId&gt;
  ## which should be transformed into:
  ## http://vimeo.com/moogaloop.swf?clip_id=&lt;videoId&gt;&amp;show_title=1
  #set ($url = $xcontext.macro.params.url.replaceAll('^.*?//.*?/(.*?)([#?].*|$)', 'http://vimeo.com/moogaloop.swf?clip_id=$1&amp;show_title=1'))
#end

Compute the width and height.

#set ($width = 600)
#set ($height = 400)
#if ($xcontext.macro.params.width)
  #set ($width = $mathtool.toInteger($xcontext.macro.params.width))
  #if ($xcontext.macro.params.height)
    #set ($height = $mathtool.toInteger($xcontext.macro.params.height))
  #else
    #set($height = $mathtool.floor($mathtool.div($width, 1.5)))
  #end
#elseif ($xcontext.macro.params.height)
  #set ($height = $mathtool.toInteger($xcontext.macro.params.height))
  #set ($width = $mathtool.floor($mathtool.mul($height, 1.5)))
#end

{{/velocity}}
{{velocity}}
#if ($url != '')

  {{html wiki="false"}}
    &lt;object width="${width}" height="${height}" type="application/x-shockwave-flash" data="${url}"&gt;&lt;param name="movie" value="${url}"&gt;&lt;/param&gt;&lt;param name="allowFullScreen" value="true"&gt;&lt;/param&gt;&lt;/object&gt;
  {{/html}}

#else

{{warning}}The Video URL you entered ($!{xcontext.macro.params.url}) does not match any of the video websites supported by this macro. Please check the address you entered or improve the macro to make it support this website.{{/warning}}

#end
{{/velocity}}</code>
</property>
<property>
<contentDescription></contentDescription>
</property>
<property>
<contentType>No content</contentType>
</property>
<property>
<defaultCategory>Content</defaultCategory>
</property>
<property>
<description>Display in your wiki page any video from Youtube, Dailymotion, Google Video or Vimeo.</description>
</property>
<property>
<id>video</id>
</property>
<property>
<name>Video</name>
</property>
<property>
<supportsInlineMode>0</supportsInlineMode>
</property>
<property>
<visibility>Current Wiki</visibility>
</property>
</object>
<object>
<class>
<name>XWiki.WikiMacroParameterClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<defaultValue>
<disabled>0</disabled>
<name>defaultValue</name>
<number>4</number>
<prettyName>Parameter default value</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</defaultValue>
<description>
<disabled>0</disabled>
<name>description</name>
<number>2</number>
<prettyName>Parameter description</prettyName>
<rows>5</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</description>
<mandatory>
<disabled>0</disabled>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>mandatory</name>
<number>3</number>
<prettyName>Parameter mandatory</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</mandatory>
<name>
<disabled>0</disabled>
<name>name</name>
<number>1</number>
<prettyName>Parameter name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
</class>
<name>Macros.Video20</name>
<number>0</number>
<className>XWiki.WikiMacroParameterClass</className>
<guid>8903a193-2e0a-494f-83dd-30abb02d0eb6</guid>
<property>
<defaultValue></defaultValue>
</property>
<property>
<description>The URL of the video you want to display on your page (Vimeo, Youtube, Daily Motion or Google Video only).</description>
</property>
<property>
<mandatory>1</mandatory>
</property>
<property>
<name>url</name>
</property>
</object>
<object>
<class>
<name>XWiki.WikiMacroParameterClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<defaultValue>
<disabled>0</disabled>
<name>defaultValue</name>
<number>4</number>
<prettyName>Parameter default value</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</defaultValue>
<description>
<disabled>0</disabled>
<name>description</name>
<number>2</number>
<prettyName>Parameter description</prettyName>
<rows>5</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</description>
<mandatory>
<disabled>0</disabled>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>mandatory</name>
<number>3</number>
<prettyName>Parameter mandatory</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</mandatory>
<name>
<disabled>0</disabled>
<name>name</name>
<number>1</number>
<prettyName>Parameter name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
</class>
<name>Macros.Video20</name>
<number>1</number>
<className>XWiki.WikiMacroParameterClass</className>
<guid>29e4bacf-4ab6-41e3-b4f0-6dde16d35639</guid>
<property>
<defaultValue></defaultValue>
</property>
<property>
<description>The width of the embedded video, in pixels. By default a size of 600 pixels is used.</description>
</property>
<property>
<mandatory>0</mandatory>
</property>
<property>
<name>width</name>
</property>
</object>
<object>
<class>
<name>XWiki.WikiMacroParameterClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<defaultValue>
<disabled>0</disabled>
<name>defaultValue</name>
<number>4</number>
<prettyName>Parameter default value</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</defaultValue>
<description>
<disabled>0</disabled>
<name>description</name>
<number>2</number>
<prettyName>Parameter description</prettyName>
<rows>5</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</description>
<mandatory>
<disabled>0</disabled>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>mandatory</name>
<number>3</number>
<prettyName>Parameter mandatory</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</mandatory>
<name>
<disabled>0</disabled>
<name>name</name>
<number>1</number>
<prettyName>Parameter name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
</class>
<name>Macros.Video20</name>
<number>2</number>
<className>XWiki.WikiMacroParameterClass</className>
<guid>3598a1ed-6690-4566-a12b-7d71f1c45380</guid>
<property>
<defaultValue></defaultValue>
</property>
<property>
<description>The height of the embedded video, in pixels. By default a height of 400 pixels is used.</description>
</property>
<property>
<mandatory>0</mandatory>
</property>
<property>
<name>height</name>
</property>
</object>
<content>Example usage:

{{code}}
{{video url="http://www.youtube.com/watch?v=Titn-yAh74A" width="660" height="440"/}}
{{/code}}

Gives:

{{video url="http://www.youtube.com/watch?v=Titn-yAh74A" width="660" height="440"/}}</content></xwikidoc>
